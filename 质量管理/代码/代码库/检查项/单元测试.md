# 单元测试

单元测试作用上应该是保证代码逻辑正常，提升代码质量。在对代码进行修改时能够保障修改的安全性。
从原则上来说提交的代码应该是应测尽测，因此这里仅列出可能不需要单元测试的部分。以及不同部分对覆盖率的一个要求

## 哪些包可以不测

1. cli形式的项目，仅涉及到简单的调用和显示时不需要进行单元测试，但是cli项目使用的util或者其中一些复杂的处理函数依然应当进行测试。
2. mock/testhelper形式的代码和结构，并非使用在实际运行代码，仅仅用于在测试中使用的代码可以不要求单元测试。
3. 独立于业务代码之外工具形式的代码，可以不要求单元测试。
4. 工具自动生成的代码不要求单元测试，但是需要确保工具的可靠性。
5. 胶水形式的代码，仅仅是包装调用的部分代码且不牵涉到额外逻辑时，不要求进行单元测试。
6. 紧急情况下（例:线上或者社区运行着发生严重故障），可以先进行热修复在后续补充测试。
7. 涉及到平台相关的代码应该覆盖到常用的平台，并且在ci中有一定的体现。

## 覆盖率要求


覆盖率要求只是按照当前的一个经验来估计，需要根据实际情况来调整这个标准
1. 工具代码要求覆盖率应当在70%以上，应当覆盖到各种情况(正常异常情况，各种边界条件)。
2. 核心逻辑代码覆盖率应当在50%左右，应当覆盖到大多数的正常异常分支。（如何认定核心代码）。
3. 非核心代码应当保证正常流程是经过测试的。
4. 经常发生变动的模块应该具备更好的测试覆盖率。


## 接口测试

项目应当进行接口测试，接口测试属于相对容易实现的集成测试，而且通过接口测试，能够测试程序整体上的调用链路，可以比较简单的覆盖到单元测试不容易做的部分，属于收益比比较高的一个测试。作为后端接口服务应该具备接口测试的能力。在设计项目接口中，应当考虑到这一块的内容。


## 一些技巧

1. 如何测试数据库代码，如果数据库支持内存运行通过内存运行数据库进行测试（参见strikememongo），如果数据库不支持可以进行一些语法层面上的测试(参见sqlmock）。
2. 如果代码中存在很多的网络调用该怎么办，可以采用一些测试网络库进行打桩（参见httptest), 如果是其他形式，可能需要自己编写桩代码。
3. 实现中对设计到存储和网络相关的部分和主体逻辑应当有一定的隔离。
4. 实现中按照单一原则进行代码组织，同时也要整体考虑到其他组件。是否可以进行更高层次的模块化。
5. 对于目前代码复杂，结构不清晰，依赖混乱的代码，建议是先进行逻辑梳理，代码重构在进行代码测试。
6. 不应当为了测试堆对代码进行不合理的改造，单元测试目的在于提升代码质量，而非简单为了追求覆盖率。